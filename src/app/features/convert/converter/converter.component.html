<div class="converter-container">
  <div class="converter-main">
    <mat-card class="converter-card">
      <mat-card-header>
        <mat-icon mat-card-avatar class="converter-icon">currency_exchange</mat-icon>
        <mat-card-title>Currency Converter</mat-card-title>
        <mat-card-subtitle>Convert between currencies with real-time rates</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="convertForm" (ngSubmit)="onConvert()">
          <div class="conversion-row">
            <!-- From Currency -->
            <div class="currency-input">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>From</mat-label>
                <mat-select formControlName="fromCurrency">
                  @for (currency of currencyStore.currencies(); track currency.code) {
                    <mat-option [value]="currency.code">
                      {{ currency.code }} - {{ currency.name }}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Amount</mat-label>
                <input
                  matInput
                  type="number"
                  formControlName="amount"
                  placeholder="0.00"
                  min="0"
                  step="0.01"
                />
                @if (convertForm.get('amount')?.hasError('required')) {
                  <mat-error>Amount is required</mat-error>
                }
                @if (convertForm.get('amount')?.hasError('min')) {
                  <mat-error>Amount must be positive</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Swap Button -->
            <button
              mat-fab
              color="primary"
              type="button"
              class="swap-button"
              (click)="swapCurrencies()"
              matTooltip="Swap currencies"
            >
              <mat-icon>swap_horiz</mat-icon>
            </button>

            <!-- To Currency -->
            <div class="currency-input">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>To</mat-label>
                <mat-select formControlName="toCurrency">
                  @for (currency of currencyStore.currencies(); track currency.code) {
                    <mat-option [value]="currency.code">
                      {{ currency.code }} - {{ currency.name }}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <!-- Result Display -->
              <div class="result-display" [class.has-result]="lastResult()">
                @if (conversionStore.isConverting()) {
                  <mat-spinner diameter="24"></mat-spinner>
                } @else if (lastResult()) {
                  <span class="result-amount">{{ lastResult()!.convertedAmount | number:'1.2-4' }}</span>
                  <span class="result-currency">{{ lastResult()!.toCurrency }}</span>
                } @else {
                  <span class="result-placeholder">Converted amount</span>
                }
              </div>
            </div>
          </div>

          <!-- Conversion Info -->
          @if (lastResult()) {
            <div class="conversion-info">
              <div class="rate-info">
                <mat-icon>trending_up</mat-icon>
                <span>
                  1 {{ lastResult()!.fromCurrency }} = {{ lastResult()!.exchangeRate | number:'1.4-6' }} {{ lastResult()!.toCurrency }}
                </span>
              </div>
              <div class="actions">
                <button
                  mat-icon-button
                  (click)="toggleFavorite()"
                  [matTooltip]="isFavorite() ? 'Remove from favorites' : 'Add to favorites'"
                >
                  <mat-icon>{{ isFavorite() ? 'star' : 'star_border' }}</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="copyResult()"
                  matTooltip="Copy result"
                >
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
            </div>
          }

          <!-- Submit Button -->
          <button
            mat-flat-button
            color="primary"
            type="submit"
            class="convert-button"
            [disabled]="convertForm.invalid || conversionStore.isConverting()"
          >
            @if (conversionStore.isConverting()) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Converting...</span>
            } @else {
              <mat-icon>currency_exchange</mat-icon>
              <span>Convert</span>
            }
          </button>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Batch Conversion -->
    <mat-card class="batch-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>view_list</mat-icon>
        <mat-card-title>Batch Convert</mat-card-title>
        <mat-card-subtitle>Convert to multiple currencies at once</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="batch-currencies">
          @for (currency of popularCurrencies; track currency) {
            <button
              mat-stroked-button
              [class.selected]="selectedBatchCurrencies().includes(currency)"
              (click)="toggleBatchCurrency(currency)"
            >
              {{ currency }}
            </button>
          }
        </div>

        <button
          mat-flat-button
          color="accent"
          (click)="batchConvert()"
          [disabled]="selectedBatchCurrencies().length === 0 || !convertForm.get('amount')?.valid || conversionStore.isConverting()"
          class="batch-button"
        >
          <mat-icon>sync</mat-icon>
          Convert to {{ selectedBatchCurrencies().length }} currencies
        </button>

        @if (batchResults().length > 0) {
          <mat-divider></mat-divider>
          <div class="batch-results">
            @for (result of batchResults(); track result.toCurrency) {
              <div class="batch-result-item">
                <span class="currency">{{ result.toCurrency }}</span>
                <span class="amount">{{ result.convertedAmount | number:'1.2-4' }}</span>
              </div>
            }
          </div>
        }
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Recent Conversions Sidebar -->
  <aside class="recent-sidebar">
    <mat-card>
      <mat-card-header>
        <mat-icon mat-card-avatar>history</mat-icon>
        <mat-card-title>Recent</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        @if (conversionStore.recentConversions().length > 0) {
          <mat-list>
            @for (conversion of conversionStore.recentConversions().slice(0, 5); track $index) {
              <mat-list-item class="recent-item" (click)="repeatConversion(conversion)">
                <div class="recent-content">
                  <span class="recent-from">{{ conversion.originalAmount | number:'1.2-2' }} {{ conversion.fromCurrency }}</span>
                  <mat-icon>arrow_forward</mat-icon>
                  <span class="recent-to">{{ conversion.convertedAmount | number:'1.2-2' }} {{ conversion.toCurrency }}</span>
                </div>
              </mat-list-item>
            }
          </mat-list>
        } @else {
          <p class="no-recent">No recent conversions</p>
        }
      </mat-card-content>
    </mat-card>

    <!-- Favorites -->
    <mat-card>
      <mat-card-header>
        <mat-icon mat-card-avatar>star</mat-icon>
        <mat-card-title>Favorites</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        @if (conversionStore.favorites().length > 0) {
          <div class="favorites-list">
            @for (pair of conversionStore.favorites(); track pair.fromCurrency + pair.toCurrency) {
              <button
                mat-stroked-button
                class="favorite-button"
                (click)="selectFavorite(pair.fromCurrency, pair.toCurrency)"
              >
                {{ pair.fromCurrency }} â†’ {{ pair.toCurrency }}
              </button>
            }
          </div>
        } @else {
          <p class="no-favorites">Star currency pairs to add favorites</p>
        }
      </mat-card-content>
    </mat-card>
  </aside>
</div>
